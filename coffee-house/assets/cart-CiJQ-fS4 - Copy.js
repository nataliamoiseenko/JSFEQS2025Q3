import{i as k,S as p,f as A,E as B}from"./api-CdfmFmXS.js";const y=k();let m=0;const T=[],N=document.getElementById("cart-content"),O=document.getElementById("cart-success"),P=document.getElementById("cart-list"),x=document.getElementById("cart-total"),w=document.getElementById("cart-shipping"),D=document.getElementById("shipping-address"),H=document.getElementById("shipping-pay"),M=document.getElementById("cart-confirm"),S=document.getElementById("cart-actions"),f=document.getElementById("cart-sum"),C=document.getElementById("confirm-loader"),L=document.getElementById("confirm-error");if(y){const e=localStorage.getItem(p.USER);if(e){const n=JSON.parse(e);D.innerText=`${n.city}, ${n.street}, ${n.houseNumber}`,H.innerText=n.paymentMethod,w.style.display="block",S.style.display="none"}}else S.style.display="flex";const R=()=>{const e=localStorage.getItem(p.CART);if(!e)return;JSON.parse(e).forEach((t,c)=>{const i=document.createElement("img");i.src=t.imgSrc,i.alt=t.name,i.classList.add("cart__img");const s=document.createElement("div");s.classList.add("cart__img-container"),s.appendChild(i);const d=document.createElement("h3");d.innerText=t.name,d.classList.add("cart__text-heading","heading-3");const r=document.createElement("span");r.innerText=`${t.selectedSize}${t.selectedAdditives?.length?`, ${t.selectedAdditives?.join(", ")}`:""}`,r.classList.add("cart__text-description");const a=document.createElement("div");a.classList.add("cart__item-text"),a.appendChild(d),a.appendChild(r);const o=document.createElement("div");o.classList.add("cart__item-product-description"),o.appendChild(s),o.appendChild(a);const l=document.createElement("div");l.classList.add("cart__prices");const v=document.createElement("h3"),{totalPrice:b,totalPriceGuest:$}=J(t);if(v.innerText=`$${b.toFixed(2)}`,v.classList.add("cart__price","heading-3"),l.appendChild(v),y){const E=document.createElement("h3");E.classList.add("cart__price-sec","heading-3"),E.innerText=`$${$.toFixed(2)}`,l.prepend(E)}const h=document.createElement("div");h.classList.add("cart__item-content"),h.appendChild(o),h.appendChild(l);const I=`${t.id}-${c}`,u=document.createElement("button");u.innerHTML=`
      <svg class="fillCurrent" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M20 9L18.005 20.3463C17.8369 21.3026 17.0062 22 16.0353 22H7.96474C6.99379 22 6.1631 21.3026 5.99496 20.3463L4 9" stroke="#403F3D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M21 6H15.375M3 6H8.625M8.625 6V4C8.625 2.89543 9.52043 2 10.625 2H13.375C14.4796 2 15.375 2.89543 15.375 4V6M8.625 6H15.375" stroke="#403F3D" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `,u.classList.add("cart__trash-button");const _=z.bind(null,I);u.addEventListener("click",_),T.push([u,_]);const g=document.createElement("li");g.classList.add("cart__item"),g.setAttribute("data-id",I),g.appendChild(u),g.appendChild(h),P.appendChild(g)}),x.innerText=`$${m.toFixed(2)}`},J=e=>{let n=0,t=0;const c=Object.values(e.sizes).find(i=>i.size===e.selectedSize);return c&&(n+=Number(y?c.discountPrice??c.price:c.price),t+=Number(c.price)),e.selectedAdditives?.forEach(i=>{const s=e.additives.find(d=>d.name===i);s&&(n+=Number(y?s.discountPrice??s.price:s.price),t+=Number(s.price))}),m+=n,{totalPrice:n,totalPriceGuest:t}},z=e=>{document.querySelectorAll(".cart__item").forEach(t=>{if(t.getAttribute("data-id")===e){const i=Number(t.querySelector(".cart__price")?.innerHTML.substring(1)),s=localStorage.getItem(p.CART);if(s){const a=JSON.parse(s).filter((o,l)=>`${o.id}-${l}`!==e);localStorage.setItem(p.CART,JSON.stringify(a))}T.forEach(([r,a])=>{r.getAttribute("data-id")===e&&r.removeEventListener("click",a)}),t.remove();const d=f.innerText;f.innerText=`${Number(d)-1}`,m-=i,x.innerText=`$${m.toFixed(2)}`}})};R();const F=async()=>{C.style.display="flex";try{const e=localStorage.getItem(p.CART);if(!e)return;const t={items:JSON.parse(e).map(c=>({productId:c.id,size:c.selectedSize,additives:c.selectedAdditives,quantity:1})),totalPrice:m};await A(B.PLACE_ORDER,{method:"POST"},JSON.stringify(t)),localStorage.setItem(p.CART,JSON.stringify([])),m=0,f.innerText="0",N.style.display="none",O.style.display="block"}catch(e){L.innerText=e,L.style.display="block"}finally{C.style.display="none"}};M.addEventListener("click",F);
