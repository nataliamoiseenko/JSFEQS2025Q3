import{i as N,S as m,f as B,E as O}from"./api-D0DhSArP.js";const h=N();let p=0;const x=[],P=document.getElementById("cart-content"),R=document.getElementById("cart-success"),k=document.getElementById("cart-list"),C=document.getElementById("cart-total"),J=document.getElementById("cart-shipping"),z=document.getElementById("shipping-address"),D=document.getElementById("shipping-pay"),F=document.getElementById("cart-confirm"),T=document.getElementById("cart-actions"),I=document.getElementById("cart-sum"),b=document.getElementById("confirm-loader"),L=document.getElementById("confirm-error");if(h){const e=localStorage.getItem(m.USER);if(e){const c=JSON.parse(e);z.innerText=`${c.city}, ${c.street}, ${c.houseNumber}`,D.innerText=c.paymentMethod,J.style.display="block",T.style.display="none"}}else T.style.display="flex";const q=()=>{const e=localStorage.getItem(m.CART);if(!e)return;JSON.parse(e).forEach((t,n)=>{const a=document.createElement("img");a.src=t.imgSrc,a.alt=t.name,a.classList.add("cart__img");const s=document.createElement("div");s.classList.add("cart__img-container"),s.appendChild(a);const i=document.createElement("h3");i.innerText=t.name,i.classList.add("cart__text-heading","heading-3");const r=document.createElement("span");r.innerText=`${t.selectedSize}${t.selectedAdditives?.length?`, ${t.selectedAdditives?.join(", ")}`:""}`,r.classList.add("cart__text-description");const d=document.createElement("div");d.classList.add("cart__item-text"),d.appendChild(i),d.appendChild(r);const o=document.createElement("div");o.classList.add("cart__item-product-description"),o.appendChild(s),o.appendChild(d);const l=document.createElement("div");l.classList.add("cart__prices");const E=document.createElement("h3"),{totalPrice:$,totalPriceGuest:A}=j(t);if(E.innerText=`$${$.toFixed(2)}`,E.classList.add("cart__price","heading-3"),l.appendChild(E),h){const f=document.createElement("h3");f.classList.add("cart__price-sec","heading-3"),f.innerText=`$${A.toFixed(2)}`,l.prepend(f)}const y=document.createElement("div");y.classList.add("cart__item-content"),y.appendChild(o),y.appendChild(l);const _=`${t.id}-${n}`,v=document.createElement("img");v.src="src/assets/svg/trash.svg",v.alt="delete";const u=document.createElement("button");u.classList.add("cart__trash-button"),u.appendChild(v);const S=w.bind(null,_);u.addEventListener("click",S),x.push([u,S]);const g=document.createElement("li");g.classList.add("cart__item"),g.setAttribute("data-id",_),g.appendChild(u),g.appendChild(y),k.appendChild(g)}),C.innerText=`$${p.toFixed(2)}`},j=e=>{let c=0,t=0;const n=Object.values(e.sizes).find(a=>a.size===e.selectedSize);return n&&(c+=Number(h?n.discountPrice??n.price:n.price),t+=Number(n.price)),e.selectedAdditives?.forEach(a=>{const s=e.additives.find(i=>i.name===a);s&&(c+=Number(h?s.discountPrice??s.price:s.price),t+=Number(s.price))}),p+=c,{totalPrice:c,totalPriceGuest:t}},w=e=>{document.querySelectorAll(".cart__item").forEach(t=>{if(t.getAttribute("data-id")===e){const a=Number(t.querySelector(".cart__price")?.innerHTML.substring(1)),s=localStorage.getItem(m.CART);if(s){const d=JSON.parse(s).filter((o,l)=>`${o.id}-${l}`!==e);localStorage.setItem(m.CART,JSON.stringify(d))}x.forEach(([r,d])=>{r.getAttribute("data-id")===e&&r.removeEventListener("click",d)}),t.remove();const i=I.innerText;I.innerText=`${Number(i)-1}`,p-=a,C.innerText=`$${p.toFixed(2)}`}})};q();const G=async()=>{b.style.display="flex";try{const e=localStorage.getItem(m.CART);if(!e)return;const t={items:JSON.parse(e).map(n=>({productId:n.id,size:n.selectedSize,additives:n.selectedAdditives,quantity:1})),totalPrice:p};await B(O.PLACE_ORDER,{method:"POST"},JSON.stringify(t)),localStorage.setItem(m.CART,JSON.stringify([])),p=0,I.innerText="0",P.style.display="none",R.style.display="block"}catch(e){L.innerText=e,L.style.display="block"}finally{b.style.display="none"}};F.addEventListener("click",G);
